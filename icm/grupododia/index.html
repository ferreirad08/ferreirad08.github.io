<!DOCTYPE html>

<html>
  <head>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
      }

      table {
        border-collapse: collapse;
        width: 350px;
        margin-left: calc(50% - 175px);
        box-shadow: -1px 1px 4px 0px grey;
      }

      th,
      td {
        border: 1px solid #000;
        padding: 8px;
        text-align: center;
        font-size: 13px;
        width: calc(350px / 7);
      }

      div {
        border-radius: 5px;
        width: 100%;
      }

      img {
        width: 350px;
        margin-left: calc(50% - 175px);
      }
    </style>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      href="https://raw.githubusercontent.com/ferreirad08/ferreirad08.github.io/main/icm/grupododia/assets/icm-logo.png"
      type="image/png"
    />
    <title>Grupo do Dia</title>
  </head>
  <body>
    <table>
      <tr>
        <th id="th_1" colspan="7"></th>
      </tr>
      <tr>
        <th>DOM</th>
        <th>SEG</th>
        <th>TER</th>
        <th>QUA</th>
        <th>QUI</th>
        <th>SEX</th>
        <th>SÁB</th>
      </tr>
      <tr>
        <td id="td_1"></td>
        <td id="td_2"></td>
        <td id="td_3"></td>
        <td id="td_4"></td>
        <td id="td_5"></td>
        <td id="td_6"></td>
        <td id="td_7"></td>
      </tr>
      <tr>
        <td id="td_8"></td>
        <td id="td_9"></td>
        <td id="td_10"></td>
        <td id="td_11"></td>
        <td id="td_12"></td>
        <td id="td_13"></td>
        <td id="td_14"></td>
      </tr>
      <tr>
        <td id="td_15"></td>
        <td id="td_16"></td>
        <td id="td_17"></td>
        <td id="td_18"></td>
        <td id="td_19"></td>
        <td id="td_20"></td>
        <td id="td_21"></td>
      </tr>
      <tr>
        <td id="td_22"></td>
        <td id="td_23"></td>
        <td id="td_24"></td>
        <td id="td_25"></td>
        <td id="td_26"></td>
        <td id="td_27"></td>
        <td id="td_28"></td>
      </tr>
      <tr>
        <td id="td_29"></td>
        <td id="td_30"></td>
        <td id="td_31"></td>
        <td id="td_32"></td>
        <td id="td_33"></td>
        <td id="td_34"></td>
        <td id="td_35"></td>
      </tr>
      <tr>
        <td id="td_36"></td>
        <td id="td_37"></td>
        <td id="td_38"></td>
        <td id="td_39"></td>
        <td id="td_40"></td>
        <td id="td_41"></td>
        <td id="td_42"></td>
      </tr>
    </table>

    <br />
    <br />
    <img id="img" alt="" onclick="share()" />

    <script>
      const meses = [
        "JANEIRO",
        "FEVEREIRO",
        "MARÇO",
        "ABRIL",
        "MAIO",
        "JUNHO",
        "JULHO",
        "AGOSTO",
        "SETEMBRO",
        "OUTUBRO",
        "NOVEMBRO",
        "DEZEMBRO",
      ];

      const colors = [, "#69fc3a", "#fa9603", "#fdfb0b", "#c4daf2"];

      const today = new Date();
      const group = getGroupOfDay(
        today.getFullYear(),
        today.getMonth(),
        today.getDate()
      );

      const img = document.getElementById("img");
      img.src = `https://raw.githubusercontent.com/ferreirad08/ferreirad08.github.io/main/icm/grupododia/assets/${group}.jpg`;

      document.getElementById("th_1").innerHTML = `${
        meses[today.getMonth()]
      } DE ${today.getFullYear()}`;

      const firstDayOfWeekOfMonth = getFirstDayOfWeekOfMonth(
        today.getFullYear(),
        today.getMonth()
      );

      const lastDayOfMonth = getLastDayOfMonth(
        today.getFullYear(),
        today.getMonth()
      );

      for (let i = 1; i <= lastDayOfMonth; i++) {
        const td = document.getElementById(`td_${firstDayOfWeekOfMonth + i}`);
        const group = getGroupOfDay(today.getFullYear(), today.getMonth(), i);
        td.innerHTML = `${i}<br /><div style="background-color: ${colors[group]}">G${group}</div>`;
        td.style.backgroundColor = i === today.getDate() ? "#ddd" : "#fff";
      }

      function getLastDayOfMonth(year, month) {
        return new Date(year, month + 1, 0).getDate();
      }

      function getFirstDayOfWeekOfMonth(year, month) {
        return new Date(year, month, 1).getDay();
      }

      function getGroupOfDay(year, month, day) {
        const days = Math.floor(
          new Date(year, month, day).getTime() / (1000 * 60 * 60 * 24)
        );
        const groups = 4; // Number.parseInt(window.location.hash.slice(1));
        return ((days + 1) % groups) + 1;
      }

      async function share() {
        const blob = await (await fetch(img.src)).blob();
        const files = [new File([blob], "grupododia.jpg", blob)];
        const url = "https://ferreirad08.github.io/icm/contagemdaebd/";
        navigator.share({ files, url });
      }
    </script>
  </body>
</html>
