<!DOCTYPE html>

<html>
  <head>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
      }

      h1 {
        text-align: center;
        color: #151b54;
      }

      label {
        width: 346px;
        margin-left: calc(50% - 173px);
        font-size: 10px;
        color: #151b54;
        height: 30px;
      }

      select:focus {
        outline: none;
        border-bottom: 2px solid #151b54;
      }

      select {
        width: calc(346px + 4px);
        margin-left: calc(50% - 175px);
        height: 30px;
        border: none;
        border-bottom: 1px solid gray;
        background-color: transparent;
        margin-bottom: 10px;
      }

      input[type="button"]:disabled {
        background-color: #999999;
      }

      input[type="button"] {
        background-color: #151b54;
        color: #ffffff;
        border: none;
        width: calc(346px + 4px);
        margin-left: calc(50% - 175px);
        height: 40px;
        border-radius: 40px;
        font-weight: bold;
        margin-top: 20px;
        margin-bottom: 25px;
      }

      p {
        text-align: center;
        font-weight: bold;
        font-size: 12px;
        padding-top: 35px;
        padding-left: 5px;
        padding-right: 5px;
        padding-bottom: 40px;
        min-height: 390px;
        width: 340px;
        margin-left: calc(50% - (350px / 2));
        color: #3f3f3f;
      }
    </style>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bíblia Online - ARC</title>
  </head>
  <body>
    <h1>Bíblia Online - ARC</h1>
    <label>Livro</label>
    <select id="books" onchange="selectBook()">
      <option></option>
    </select>
    <br />

    <label>Capítulo</label>
    <select id="chapters" onchange="selectChapter()">
      <option></option>
    </select>
    <br />

    <label>Versículo inicial</label>
    <select id="verses" onchange="selectVerse()">
      <option></option>
    </select>
    <br />

    <label>Versículo final</label>
    <select id="verses-final" onchange="selectVerseFinal()">
      <option></option>
    </select>
    <br />

    <input
      type="button"
      id="button"
      value="Criar imagem"
      onclick="createImage()"
      disabled
    />
    <br />

    <p id="text"></p>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="background.js"></script>
    <script>
      const books = document.getElementById("books");
      const chapters = document.getElementById("chapters");
      const verses = document.getElementById("verses");
      const versesFinal = document.getElementById("verses-final");
      const button = document.getElementById("button");
      const text = document.getElementById("text");
      text.style.backgroundImage = `url(${background})`;
      const url =
        "https://raw.githubusercontent.com/ferreirad08/ferreirad08.github.io/main/icm/bible/ARC.json";
      let arc, formatted;

      async function main() {
        arc = await (await fetch(url)).json();

        for (const book in arc) {
          const option = document.createElement("option");
          option.text = book;
          books.add(option);
        }
      }

      function selectBook() {
        chapters.innerHTML = "<option></option>";
        verses.innerHTML = "<option></option>";
        versesFinal.innerHTML = "<option></option>";
        button.disabled = true;
        text.innerHTML = "";

        for (const chapter in arc[books.value]) {
          const option = document.createElement("option");
          option.text = Number(chapter) + 1;
          chapters.add(option);
        }
      }

      function selectChapter() {
        verses.innerHTML = "<option></option>";
        versesFinal.innerHTML = "<option></option>";
        button.disabled = true;
        text.innerHTML = "";

        for (const verse in arc[books.value][chapters.value - 1]) {
          const option = document.createElement("option");
          option.text = Number(verse) + 1;
          verses.add(option);
        }
      }

      function selectVerse() {
        versesFinal.innerHTML = verses.innerHTML;
        button.disabled = true;
        text.innerHTML = "";
      }

      function selectVerseFinal() {
        button.disabled = false;
        text.innerHTML = "";

        let i = Number(verses.value),
          j = Number(versesFinal.value);

        if (i > j) {
          return window.alert(
            "O verso final deve ser maior ou igual ao inicial."
          );
        }

        for (const verse of arc[books.value][chapters.value - 1].slice(
          i - 1,
          j
        )) {
          text.innerHTML += `<br />${i}. ` + verse;
          i++;
        }

        text.innerHTML += `<br /><br /><a style="font-size: 20px">${books.value} ${chapters.value}</a>`;
      }

      function createImage() {
        html2canvas(text, {
          height: text.clientHeight,
        }).then(function (canvas) {
          const a = document.createElement("a");
          a.download = "text.jpg";
          a.href = canvas.toDataURL("image/jpeg");
          a.click();
        });
      }

      main();
    </script>
  </body>
</html>
